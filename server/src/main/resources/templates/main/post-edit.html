<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/css/main/post.css" />
    <link
            href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
            rel="stylesheet"
    />

    <link
            href="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote.min.css"
            rel="stylesheet"
    />
    <link
            href="https://fonts.googleapis.com/css2?family=Do+Hyeon&family=Dongle&family=Gamja+Flower&family=Gaegu&family=Gowun+Dodum&family=Hi+Melody&family=Jua&family=Noto+Sans+KR&family=Poor+Story&display=swap"
            rel="stylesheet"
    />
    <style>
        /* 에디터의 폭과 최소 높이 명확히 지정 */
        .note-editor {
            width: 100% !important;
            max-width: 745px;
        }

        .note-editable {
            min-height: 300px;
            width: 100% !important;
            box-sizing: border-box;
            padding: 10px;
        }

        .summernote {
            width: 100% !important;
            max-width: 700px;
            display: none !important;
        }
    </style>
</head>
<body>
<form id="post-form" action="/main/post" method="post">
    <input type="hidden" name="channelId" th:value="${post.channelId}" />
    <section class="FlgStack-root-need jk-feelog-section001">
        <div class="FlgBox-root-need">
            <div class="FlgBox-root-need jk-feelog-div003">
                <div class="FlgStack-root-need jk-feelog-div004">
                    <div class="FlgStack-root-need jk-feelog-div005">
                        <div class="FlgStack-root-need jk-feelog-div006">
                            <button
                                    aria-label="종료"
                                    class="cancel-bnt FlgIconButton-root-need FlgIconButton-sizeSm-need jk-feelog-btn001"
                                    type="button"
                            >
                                <svg
                                        focusable="false"
                                        aria-hidden="true"
                                        viewBox="0 0 24 24"
                                        width="24"
                                        height="24"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="jk-feelog-main-svg01"
                                >
                                    <path
                                            d="M3.54 12.682a.949.949 0 0 1-.29-.68c0-.258.105-.5.29-.68l6.874-6.562a.937.937 0 0 1 1.293 1.355l-5.18 4.95h13.286c.519 0 .937.418.937.937 0 .52-.418.938-.938.938H6.527l5.184 4.945a.938.938 0 0 1-1.293 1.355l-6.875-6.562-.004.004Z"
                                            fill="currentcolor"
                                    ></path>
                                </svg>
                            </button>
                            <button
                                    aria-label="뒤로가기"
                                    class="back-btn FlgIconButton-root-need FlgIconButton-sizeSm-need jk-feelog-btn001"
                                    type="button"
                                    style="display: none"
                            >
                                <svg
                                        focusable="false"
                                        aria-hidden="true"
                                        viewBox="0 0 24 24"
                                        width="24"
                                        height="24"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="jk-feelog-main-svg01"
                                >
                                    <path
                                            d="M3.54 12.682a.949.949 0 0 1-.29-.68c0-.258.105-.5.29-.68l6.874-6.562a.937.937 0 0 1 1.293 1.355l-5.18 4.95h13.286c.519 0 .937.418.937.937 0 .52-.418.938-.938.938H6.527l5.184 4.945a.938.938 0 0 1-1.293 1.355l-6.875-6.562-.004.004Z"
                                            fill="currentcolor"
                                    ></path>
                                </svg>
                            </button>
                            <input
                                    class="jk-feelog-input001"
                                    placeholder="제목을 입력하세요"
                                    id="title-input"
                                    name="postTitle" th:value="${post.postTitle}"
                            />
                        </div>
                        <div class="FlgStack-root-need jk-feelog-div007">
                            <p class="jk-feelog-p003">
                                0<span class="jk-feelog-span001">자</span>
                            </p>
                            <div
                                    class="FlgStack-root-need jk-feelog-div008"
                            >
                                <button
                                        tabindex="0"
                                        aria-haspopup="menu"
                                        aria-expanded="false"
                                        aria-controls=":r0:"
                                        title="더 보기"
                                        class="FlgIconButton-root-need FlgIconButton-sizeSm-need jk-feelog-div008 FlgMenuButton-sizeMd-need jk-feelog-btn001"
                                        type="button"
                                >
                                    <svg
                                            focusable="false"
                                            aria-hidden="true"
                                            viewBox="0 0 24 24"
                                            width="24"
                                            height="24"
                                            fill="none"
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="jk-feelog-main-svg01"
                                    >
                                        <path
                                                d="M20.125 12a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm-6.25 0a1.875 1.875 0 1 1-3.751 0 1.875 1.875 0 0 1 3.751 0ZM5.75 13.875a1.875 1.875 0 1 1 0-3.75 1.875 1.875 0 0 1 0 3.75Z"
                                                fill="currentcolor"
                                        ></path>
                                    </svg></button
                                ><button
                                    title="단축키 도움말"
                                    class="FlgIconButton-root-need FlgIconButton-sizeMd-need jk-feelog-btn002"
                                    type="button"
                            >
                                <svg
                                        focusable="false"
                                        aria-hidden="true"
                                        viewBox="0 0 24 24"
                                        width="24"
                                        height="24"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="jk-feelog-main-svg01"
                                >
                                    <path
                                            d="M20.125 12a8.125 8.125 0 1 0-16.25 0 8.125 8.125 0 0 0 16.25 0ZM2 12a10 10 0 1 1 20 0 10 10 0 0 1-20 0Zm6.633-3.543A2.191 2.191 0 0 1 10.695 7h2.278a2.465 2.465 0 0 1 1.226 4.605l-1.261.723a.94.94 0 0 1-.938.922.935.935 0 0 1-.938-.938v-.527c0-.336.18-.644.473-.812l1.73-.993a.59.59 0 0 0-.292-1.101h-2.278a.308.308 0 0 0-.293.207l-.015.047a.937.937 0 0 1-1.196.57.94.94 0 0 1-.57-1.195l.016-.047-.004-.004Zm2.117 7.293a1.25 1.25 0 1 1 2.5 0 1.25 1.25 0 0 1-2.5 0Z"
                                            fill="currentcolor"
                                    ></path>
                                </svg>
                            </button>
                            </div>
                            <div
                                    class="FlgStack-root-need jk-feelog-div008"
                            >
                                <button
                                        class="preview-btn FlgButton-sizeSm-need jk-feelog-btn003"
                                        type="button"
                                        style="display: block"
                                        id="preview-btn"
                                >
                                    다음
                                </button>
                                <button
                                        class="post-btn FlgButton-sizeSm-need jk-feelog-btn003"
                                        type="submit"
                                        style="display: none"
                                >
                                    발행
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div
                        class="keep-editor-selection-zone FlgBox-root-need jk-feelog-div009"
                >
                        <textarea class="summernote FlgStack-root-need jk-feelog-div010"
                                  name="postContent"
                                  th:text="${post.postContent}"
                                  style="display: none !important;"></textarea>
                    <input type="hidden" name="postFilePath" th:value="${post.postFilePath}" />
                    <input type="hidden" name="postFileName" th:value="${post.postFileName}" />
                    <input type="hidden" name="postFileSize" th:value="${post.postFileSize}" />
                    <hr class="jk-feelog-hr01" />

                </div>
            </div>

            <button
                    aria-label="하단에 공백 추가"
                    tabindex="-1"
                    class="jk-feelog-btn004"
            ></button>
            <div class="FlgStack-root-need jk-feelog-div011">
                <div class="FlgStack-root-need jk-feelog-div012">
                    <button
                            title="블록 위로 이동 (Ctrl+Shift+↑)"
                            class="FlgIconButton-root-need FlgIconButton-sizeSm-need jk-feelog-btn001"
                            type="button"
                    >
                        <svg
                                focusable="false"
                                aria-hidden="true"
                                viewBox="0 0 24 24"
                                width="24"
                                height="24"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                                class="jk-feelog-main-svg01"
                        >
                            <path
                                    d="M11.332 8.713a.934.934 0 0 1 1.325 0l5.254 5.25a.937.937 0 0 1-1.324 1.324L12 10.701l-4.59 4.59a.937.937 0 0 1-1.324-1.324l5.245-5.254Z"
                                    fill="currentcolor"
                            ></path>
                        </svg></button
                    ><button
                        title="블록 아래로 이동 (Ctrl+Shift+↓)"
                        class="FlgIconButton-root-need FlgIconButton-sizeSm-need jk-feelog-btn001"
                        type="button"
                >
                    <svg
                            focusable="false"
                            aria-hidden="true"
                            viewBox="0 0 24 24"
                            width="24"
                            height="24"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                            class="jk-feelog-main-svg01"
                    >
                        <path
                                d="M12.666 15.291a.934.934 0 0 1-1.324 0l-5.254-5.25a.937.937 0 0 1 1.324-1.324l4.586 4.586 4.59-4.59a.937.937 0 0 1 1.324 1.324l-5.246 5.254Z"
                                fill="currentcolor"
                        ></path>
                    </svg>
                </button>
                </div>
                <button
                        title="새 줄 추가"
                        class="FlgIconButton-root-need FlgIconButton-sizeLg-need jk-feelog-btn005"
                        type="button"
                >
                    <svg
                            focusable="false"
                            aria-hidden="true"
                            viewBox="0 0 24 24"
                            width="24"
                            height="24"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                            class="jk-feelog-main-svg02"
                    >
                        <path
                                d="M19.135 4.959c0-.508.39-.938.937-.938a.95.95 0 0 1 .938.938v6.563a3.443 3.443 0 0 1-3.438 3.437H6.174l3.398 3.398c.39.391.39.977 0 1.329a.855.855 0 0 1-1.289 0l-5-5a.855.855 0 0 1 0-1.29l5-5.039a.92.92 0 0 1 1.29 0c.39.391.39.977 0 1.329l-3.4 3.398h11.4c.859 0 1.562-.703 1.562-1.563V4.96Z"
                                fill="currentcolor"
                        ></path>
                    </svg>
                </button>
            </div>
        </div>
    </section>
    <div role="presentation" class="FlgModal-root-need jk-feelog-div013">
        <div aria-hidden="true" open="" class="jk-feelog-div014"></div>
        <div tabindex="0" data-testid="sentinelStart"></div>
        <div
                role="dialog"
                aria-modal="true"
                aria-labelledby=":r2j:"
                aria-describedby=":r2k:"
                tabindex="-1"
                class="FlgModalDialog-sizeLg-need jk-feelog-div015"
        >
            <div class="FlgBox-root-need jk-feelog-div016">
                <h2 id=":r2j:" class="jk-feelog-h2-001">발행하기</h2>
                <button
                        aria-label="닫기"
                        class="FlgModalClose-root-need jk-feelog-btn006"
                        type="button"
                >
                    <svg
                            focusable="false"
                            aria-hidden="true"
                            viewBox="0 0 24 24"
                            data-testid="CloseIcon"
                            class="jk-feelog-main-svg03"
                    >
                        <path
                                d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                        ></path>
                    </svg>
                </button>
            </div>
            <hr class="jk-feelog-hr03" />
            <div id=":r2k:" class="jk-feelog-div017">
                <div class="FlgStack-root-need jk-feelog-div018">
                    <div id="preview-section" style="
                                height: 415px;
                                width: 100%;
                                border: 1px solid #dadadc;
                                margin-bottom: 30px;
                                border-radius: 8px;
                            ">
                        <!-- <div class="FlgBox-root-need joy-vidjsr"></div> -->
                    </div>
                    <div class="FlgStack-root-need jk-feelog-div019">
                        <div class="FlgStack-root-need jk-feelog-div020">
                            <p class="jk-feelog-p004">대표 이미지</p>
                            <p class="jk-feelog-p005">0/20</p>
                        </div>
                        <div class="FlgBox-root-need jk-feelog-div021">
                            <div
                                    class="FlgStack-root-need jk-feelog-div022"
                            >
                                <div
                                        class="FlgStack-root-need jk-feelog-div023"
                                >
                                    <div
                                            class="FlgStack-root-need jk-feelog-div024"
                                    >
                                        <button
                                                class="FlgIconButton-root-need FlgIconButton-sizeMd-need jk-feelog-btn007"
                                                type="button"
                                        >
                                            <svg
                                                    focusable="false"
                                                    aria-hidden="true"
                                                    viewBox="0 0 24 24"
                                                    width="24"
                                                    height="24"
                                                    fill="none"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    class="jk-feelog-main-svg04"
                                            >
                                                <path
                                                        d="M12.938 4.813A.935.935 0 0 0 12 3.875a.935.935 0 0 0-.938.938v6.25h-6.25a.935.935 0 0 0-.937.937c0 .52.418.938.938.938h6.25v6.25c0 .519.417.937.937.937s.938-.418.938-.938v-6.25h6.25c.519 0 .937-.417.937-.937a.935.935 0 0 0-.938-.938h-6.25v-6.25Z"
                                                        fill="currentcolor"
                                                ></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="file-preview" style="margin-top: 10px; font-size: 14px; color: #555;">
                                        <div th:each="file : ${post.fileList}" class="preview-wrapper" style="position: relative; display: inline-block; margin-right: 10px;">
                                            <img th:src="@{|/file/display?path=${post.postFilePath}/${post.postFileName}|}" style="max-width: 100px; border-radius: 8px;" />
                                            <button type="button" class="delete-thumbnail-btn" style="
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(0,0,0,0.5);
            border: none;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-weight: bold;
            cursor: pointer;
        ">×</button>

                                            <input type="hidden" name="fileIds" th:value="${file.id}" />
                                        </div>
                                    </div>
                                    <input
                                            type="file"
                                            id="hidden-file-input"
                                            hidden
                                    />
                                </div>
                                <p class="jk-feelog-p006">
                                    최대 50MB의 이미지 파일을 올릴 수
                                    있어요.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="FlgStack-root-need jk-feelog-div019">
                        <div class="FlgStack-root-need jk-feelog-div020">
                            <p class="jk-feelog-p004">태그</p>
                        </div>
                        <div class="FlgBox-root-need jk-feelog-div021">
                            <div class="FlgStack-root-need jk-feelog-div025">
                                <!-- 기존 태그가 있을 경우 서버에서 반복 렌더링 -->
                                <th:block th:each="tag : ${post.tags}">

                                <div th:each="tag : ${tags}"
                                     class="FlgChip-root-need FlgChip-colorPrimary FlgChip-sizeMd-need FlgChip-variantSoft-need joy-1g753be">
                                    <span class="FlgChip-label-need FlgChip-label-needMd jk-feelog-span006" th:text="${tag}">힐링</span>
                                    <span class="FlgChip-endDecorator joy-1i201st">
            <button class="FlgChipDelete-root FlgChipDelete-variantSoft FlgChipDelete-colorPrimary joy-1rgf1fl" type="button">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none">
                    <path d="M17.979 7.354a.937.937 0 0 0-1.324-1.324l-4.65 4.648-4.651-4.653A.937.937 0 0 0 6.03 7.35l4.648 4.649-4.653 4.652a.937.937 0 0 0 1.324 1.324l4.649-4.648 4.652 4.652a.937.937 0 0 0 1.324-1.324l-4.648-4.648 4.652-4.652Z" fill="currentcolor"></path>
                </svg>
            </button>
        </span>
                                </div>
                                </th:block>

                                <!-- 태그 입력창 -->
                                <div class="FlgInput-root-need jk-feelog-div026">
                                    <input
                                            aria-label="태그"
                                            id="input-tag"
                                            placeholder=""
                                            class="FlgInput-input-need jk-feelog-input002"
                                    />
                                </div>
                            </div>
                            <div class="jk-feelog-div027">
                                <p class="jk-feelog-p007">
                                    태그는 띄어쓰기(space)로 구분해 주세요.
                                    각 20자 이하로 5개까지 입력할 수 있어요.
                                    한글, 영문, 숫자, 밑줄(_)만 입력할 수
                                    있어요.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="FlgStack-root-need jk-feelog-div019">
                        <div class="FlgStack-root-need jk-feelog-div020">
                            <p class="jk-feelog-p004">포스트 타입</p>
                        </div>
                        <div class="FlgBox-root-need jk-feelog-div021">
                            <div class="FlgStack-root-need jk-feelog-div028">
                                <div class="jk-feelog-div029">
                                    <button id="" type="button" class="jk-feelog-btn008">
                                        포스트 타입
                                    </button>
                                    <div class="jk-feelog-div030">
                                        <button role="combobox" aria-expanded="false" aria-controls=":r2o:" aria-labelledby=":r2n:-label" id="select-toggle" name="visibilityOption" class="jk-feelog-btn009" type="button" th:text="${post.postType eq 'POST' ? '포스트' : '응원글'}"></button>
                                        <span class="FlgSelect-indicator-need jk-feelog-span002">
                                            <svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg" class="jk-feelog-main-svg05">
                                                    <path d="M12.666 15.291a.934.934 0 0 1-1.324 0l-5.254-5.25a.937.937 0 0 1 1.324-1.324l4.586 4.586 4.59-4.59a.937.937 0 0 1 1.324 1.324l-5.246 5.254Z" fill="currentcolor"></path></svg>
                                        </span>
                                        <input tabindex="-1" aria-hidden="true" value="SUBSCRIBER" name="postType" th:value="${post.postType}" style="
                                                    border: 0px;
                                                    clip: rect(
                                                        0px,
                                                        0px,
                                                        0px,
                                                        0px
                                                    );
                                                    height: 1px;
                                                    margin: -1px;
                                                    overflow: hidden;
                                                    padding: 0px;
                                                    position: absolute;
                                                    white-space: nowrap;
                                                    width: 1px;
                                                ">
                                    </div>
                                    <ul role="listbox" id="select-options" tabindex="-1" class="select-options jk-feelog-ul001" hidden="" style="
                                                position: absolute;
                                                inset: 0px auto auto 0px;
                                                margin: 0px;
                                                transform: translate(
                                                    719px,
                                                    497px
                                                );
                                                width: 564px;
                                                z-index: 11111;
                                            " data-popper-placement="bottom">
                                        <li tabindex="0" id=":r39:" role="option" aria-selected="false" class="jk-feelog-li003">
                                            포스트
                                        </li>
                                        <li tabindex="-1" id=":r3a:" role="option" aria-selected="false" class="jk-feelog-li003">
                                            응원글
                                        </li>
                                    </ul>
                                </div>
                                <div class="jk-feelog-div027"></div>
                            </div>
                        </div>
                    </div>
                    <div class="FlgStack-root-need jk-feelog-div031"></div>
                </div>
            </div>
            <hr class="jk-feelog-hr04" />
            <div data-last-child="" class="jk-feelog-div032">
                <button
                        class="FlgButton-sizeMd-need jk-feelog-btn010"
                        type="submit"
                >
                    <span>발행하기</span></button
                ><button
                    class="FlgButton-sizeMd-need jk-feelog-btn011"
                    type="button"
            >
                <span>취소</span>
            </button>
            </div>
        </div>
        <div tabindex="0" data-testid="sentinelEnd"></div>
    </div>
</form>
</body>
<script src="/js/main/post-edit.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote.min.js"></script>
<script th:inline="javascript">
    const postContent = /*[[${post.postContent}]]*/ '';

    $(document).ready(function () {
        $(".summernote").summernote({
            height: 650,
            fontNames: [
                "Arial", "Noto Sans KR", "Jua", "Dongle", "Do Hyeon",
                "Gowun Dodum", "Poor Story", "Hi Melody", "Gamja Flower", "Gaegu"
            ],
            fontNamesIgnoreCheck: [
                "Noto Sans KR", "Jua", "Dongle", "Do Hyeon", "Gowun Dodum",
                "Poor Story", "Hi Melody", "Gamja Flower", "Gaegu"
            ],
            disableResizeEditor: true,
            callbacks: {
                onImageUpload: function (files) {
                    for (let i = 0; i < files.length; i++) {
                        const formData = new FormData();
                        formData.append("file", files[i]);

                        $.ajax({
                            url: "/file/upload",
                            method: "POST",
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function (res) {
                                const fileDTO = res.thumbnail;
                                const fileId = fileDTO.id;

                                // 이미지 삽입
                                const imageUrl = "/file/display?path=" + fileDTO.filePath + "/" + fileDTO.fileName;
                                $(".summernote").summernote("insertImage", imageUrl);

                                // fileId를 hidden input으로 form에 추가
                                const input = document.createElement("input");
                                input.type = "hidden";
                                input.name = "fileIds";
                                input.value = fileId;

                                const form = $(".summernote").closest("form")[0];
                                if (form) form.appendChild(input);
                                console.log("현재 추가 대상 form:", document.querySelector("form"));
                            },
                            error: function () {
                                alert("이미지 업로드 실패");
                            }
                        });
                    }
                }
            }
        });
        // 기존 다이어리 내용 삽입
        $(".summernote").summernote("code", postContent);
    });
</script>

</html>
